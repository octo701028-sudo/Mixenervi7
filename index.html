<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#6a00ff">
  <title>Enervi7 èƒ½é‡è¦ºå¯Ÿï½œè¡Œå‹•å‹•åŠ›å…«éµç‰ˆ</title>
  <link rel="manifest" href="manifest.json">
  <style>
    :root{
      --bg:#0f0b1a;
      --card:#1b1330;
      --text:#f8f5ff;
      --muted:#cbb7ff;
      --accent:#6a00ff;
      --good:#00d084;
      --warn:#ffb700;
      --bad:#ff4d4f;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,"Noto Sans TC","PingFang TC","Microsoft JhengHei",Arial,sans-serif}
    header{padding:24px 16px 8px;display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:40px;height:40px;border-radius:12px;background:linear-gradient(135deg,var(--accent),#b388ff);display:grid;place-items:center;font-weight:900}
    .logo span{font-size:18px}
    h1{font-size:18px;margin:0}
    .summon{font-size:14px;color:var(--muted);margin-top:4px;max-width:680px}
    .panel{background:var(--card);border:1px solid #2b1d4f;border-radius:16px;padding:16px;margin:12px 16px}
    .row{display:grid;grid-template-columns:1fr 120px;gap:12px;align-items:center;margin:10px 0}
    .row label{font-size:14px}
    .row input[type=range]{width:100%}
    .chips{display:flex;flex-wrap:wrap;gap:8px}
    .chip{background:#2b1d4f;border:1px solid #3a2a62;border-radius:999px;padding:6px 10px;font-size:12px}
    button{background:var(--accent);color:#fff;border:none;border-radius:12px;padding:12px 16px;font-weight:700;cursor:pointer}
    button.ghost{background:transparent;border:1px solid #3a2a62;color:var(--text)}
    .actions{display:flex;gap:8px;flex-wrap:wrap}
    .grid{display:grid;gap:12px}
    @media(min-width:960px){.grid{grid-template-columns:1.2fr 1fr}}
    .badge{background:#2b1d4f;border:1px solid #3a2a62;border-radius:12px;padding:10px;display:flex;align-items:center;gap:8px}
    .badge .emo{font-size:20px}
    .muted{color:var(--muted);font-size:13px}
    .title{font-weight:800;margin-bottom:8px}
    .section-title{font-weight:800;margin:8px 16px}
    .radar-wrap{background:#120d21;border:1px solid #2b1d4f;border-radius:16px;padding:12px;display:grid;place-items:center}
    svg{max-width:100%;height:auto}
    .kvs{display:grid;gap:8px}
    details{background:#120d21;border:1px solid #2b1d4f;border-radius:12px;padding:10px}
    summary{cursor:pointer}
    .footer{padding:24px 16px 48px;color:var(--muted);text-align:center;font-size:12px}
    .color-pick{display:flex;align-items:center;gap:8px}
    input[type=color]{width:40px;height:32px;border-radius:8px;border:1px solid #3a2a62;background:transparent;padding:0}
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="logo"><span>E7</span></div>
      <div>
        <h1>Enervi7 è¡Œå‹•å‹•åŠ›å…«éµç‰ˆ</h1>
        <div id="summon" class="summon">ä½ æ­£åœ¨è¸ä¸Šä¸€æ¢éˆé­‚å›æ­¸çš„é“è·¯ã€‚</div>
      </div>
    </div>
    <div class="color-pick">
      <label for="theme">ä¸»é¡Œè‰²ï¼š</label>
      <input id="theme" type="color" value="#6a00ff" title="é¸æ“‡ä¸»é¡Œé¡è‰²">
      <button id="resetTheme" class="ghost">é‡ç½®</button>
    </div>
  </header>

  <section class="panel grid">
    <div>
      <div class="title">ä¸ƒéšæ¸¬é©—ï¼ˆç§»å‹•æ»‘æ¡¿ï¼Œé»æ“Šã€Œç”Ÿæˆèƒ½é‡åœ–ã€ï¼‰</div>
      <div id="sliders"></div>
      <div class="actions" style="margin-top:12px">
        <button id="gen">ç”Ÿæˆèƒ½é‡åœ–</button>
        <button id="download" class="ghost">ä¸‹è¼‰åˆ†äº«å¡</button>
      </div>
      <div style="margin-top:12px" class="muted">æç¤ºï¼šé¦–æ¬¡å®Œæˆæ¸¬é©—ã€é€£çºŒ 7 æ—¥å®Œæˆæ¸¬é©—ã€ç´¯ç© 10 æ¬¡æ¸¬é©—ï¼Œæœƒè§£é–å¾½ç« ã€‚</div>
    </div>
    <div>
      <div class="title">èƒ½é‡é›·é”åœ–</div>
      <div class="radar-wrap"><svg id="radar" width="420" height="420" viewBox="0 0 420 420" role="img" aria-label="Enervi7 Radar"></svg></div>
    </div>
  </section>

  <section class="panel grid">
    <div>
      <div class="title">çµæœèˆ‡è¡Œå‹•å»ºè­°</div>
      <div id="summary"></div>
      <div class="kvs" id="kvs" style="margin-top:12px"></div>
    </div>
    <div>
      <div class="title">å¾½ç« èˆ‡é€£çºŒæ—¥</div>
      <div class="badge"><span class="emo">ğŸ”¥</span><div><div><strong>é€£çºŒæ—¥</strong></div><div id="streak" class="muted">0</div></div></div>
      <div class="badge" style="margin-top:8px;"><span class="emo">ğŸ…</span><div><div><strong>å·²è§£é–å¾½ç« </strong></div><div id="badges" class="chips"></div></div></div>
      <div class="badge" style="margin-top:8px;"><span class="emo">ğŸ“Š</span><div><div><strong>ç´¯ç©æ¸¬é©—</strong></div><div id="tests" class="muted">0</div></div></div>
    </div>
  </section>

  <h3 class="section-title">è¡Œå‹•å‹•åŠ›å…«éµï¼ˆä½ çš„ç•¶å‰é…æ–¹ï¼‰</h3>
  <section class="panel">
    <div id="e8x" class="chips"></div>
  </section>

  <div class="footer">Â© Enervi7 â€” ä»¥å¬å–š Ã— æˆå°± Ã— å‰µé€  Ã— é€£çºŒè¡Œå‹•ï¼Œè®“èƒ½é‡æ—…ç¨‹æ›´æ²‰æµ¸ã€‚</div>

  <script>
    // ---------- Data ----------
    const STAGES = [
      { key:'white',  name:'ç™½ / èƒ½é‡è¦ºçŸ¥',     emoji:'ğŸ’¡', kv:'è¦ºçŸ¥èˆ‡æ¸…æ˜', action:'ä»Šæ—¥è¦ºå¯Ÿä¸‰æ¬¡å‘¼å¸ã€‚', oil:'ä¹³é¦™ã€å°¤åŠ åˆ©ã€èŒ¶æ¨¹' },
      { key:'blue',   name:'è— / ç©©å®šèˆ‡æ·¨åŒ–',   emoji:'ğŸ’§', kv:'ç©©å®šèˆ‡æ·¨åŒ–', action:'ååˆ†é˜éœåèˆ‡ç©ºé–“æ·¨åŒ–ã€‚', oil:'é¼ å°¾è‰ã€è–„è·ã€é¼ å°¾è‰è¤‡æ–¹' },
      { key:'orange', name:'æ©™ / èƒ½é‡æµå‹•',     emoji:'ğŸ§¡', kv:'æµå‹•èˆ‡å‰µé€ ', action:'ä¸€æ®µéŸ³æ¨‚ï¼èˆå‹•ä¸‰åˆ†é˜ã€‚', oil:'ç”œæ©™ã€ä¾è˜­ã€æŸ‘æ©˜è¤‡æ–¹' },
      { key:'yellow', name:'é»ƒ / å…§åœ¨åŠ›é‡',     emoji:'â˜€ï¸', kv:'åŠ›é‡èˆ‡é‚Šç•Œ', action:'å®Œæˆä¸€å€‹å¾®è¡Œå‹•ä¸¦è¨˜éŒ„ã€‚', oil:'æª¸æª¬è‰ã€è¿·è¿­é¦™ã€å£«æ°£è¤‡æ–¹' },
      { key:'green',  name:'ç¶  / å…±æŒ¯èˆ‡é€£çµ',   emoji:'ğŸ’š', kv:'é€£çµèˆ‡æ…ˆæ‚²', action:'å‘ä¸€äººè¡¨é”æ„Ÿè¬ã€‚', oil:'ç«ç‘°è‰ã€å¤©ç«ºè‘µã€å¿ƒè¼ªè¤‡æ–¹' },
      { key:'indigo', name:'é›è— / æ„è­˜æ“´å±•',   emoji:'ğŸ”®', kv:'æ´è¦‹èˆ‡ç›´è¦º', action:'é–‰çœ¼ä¸‰åˆ†é˜è§€æƒ³ç¬¬ä¸‰çœ¼ã€‚', oil:'è–°è¡£è‰ã€ä¹³é¦™ã€å†¥æƒ³è¤‡æ–¹' },
      { key:'violet', name:'ç´« / éˆé­‚æ•´åˆ',     emoji:'ğŸ’œ', kv:'æ•´åˆèˆ‡è¶…è¶Š', action:'æ›¸å¯«ä¸‰å¥ã€Œæˆ‘å·²å®Œæˆã€ã€‚', oil:'å»£è—¿é¦™ã€å²©è˜­è‰ã€éˆé­‚è¤‡æ–¹' }
    ];

    // E8: è¡Œå‹•å‹•åŠ›å…«éµï¼ˆè‡ªå®šç¾©å‘½åï¼‰
    const E8 = [
      { name:'å¬å–šä¹‹å¿ƒ',   desc:'è®“äººè¦ºå¾—åƒèˆ‡çš„æ˜¯æ›´å¤§çš„æ•…äº‹' },     // ä½¿å‘½æ„Ÿ
      { name:'æˆå°±ä¹‹æµ',   desc:'çœ‹è¦‹è‡ªå·±çš„æˆé•·èˆ‡çªç ´' },           // æˆå°±
      { name:'å‰µé€ å›éŸ¿',   desc:'çµ¦äºˆå‰µä½œç©ºé–“èˆ‡å³æ™‚å›é¥‹' },         // å‰µé€ /å›é¥‹
      { name:'æ­¸å±¬èˆ‡æ“æœ‰', desc:'è¦ºå¾—ã€Œé€™æ˜¯æˆ‘çš„ã€ä¸¦é¡˜æ„æŠ•å…¥' },     // æ“æœ‰
      { name:'ç¤¾äº¤å…±æŒ¯',   desc:'èªå¯ã€åˆä½œã€ç«¶çˆ­å¸¶ä¾†é€£çµ' },       // ç¤¾äº¤
      { name:'é™æ™‚ç¨€æœ‰',   desc:'æœ‰é™èˆ‡å€’æ•¸è®“äººæ›´æƒ³è¡Œå‹•' },         // ç¨€ç¼º/æ€¥è¿«
      { name:'é©šå–œæ¢ç´¢',   desc:'ä¸ç¢ºå®šèˆ‡é©šå–œè®“äººä¿æŒå¥½å¥‡' },       // ä¸ç¢ºå®š
      { name:'é€£çºŒå®ˆè­·',   desc:'é¿å…å¤±å»æ—¢æœ‰æˆæœè€ŒæŒçºŒ' }          // é¿å…å¤±å»
    ];

    const SUMMON_LINES = [
      'ä½ æ­£åœ¨è¸ä¸Šä¸€æ¢éˆé­‚å›æ­¸çš„é“è·¯ã€‚',
      'å®‡å®™åœ¨ç­‰ä½ é»äº®ä¸‹ä¸€éšçš„å…‰ã€‚',
      'ä½ å·²æº–å‚™å¥½æ¥ä½è±ç››çš„èƒ½é‡æµã€‚',
      'ç•¶ä½ è¦ºå¯Ÿï¼Œä¸–ç•Œå°±æ”¹è®Šã€‚',
      'ä¿¡ä»»ä½ çš„å…‰ï¼Œå®ƒæ­£å¸¶ä½ å‰è¡Œã€‚',
      'æ¯ä¸€æ¬¡å‘¼å¸ï¼Œéƒ½æ˜¯ä¸€å€‹æ–°çš„é–‹å§‹ã€‚'
    ];

    const LS = { theme:'e7_theme', tests:'e7_tests', streak:'e7_streak', last:'e7_last', badges:'e7_badges' };
    const $ = (s)=>document.querySelector(s);

    function todayStr(){ const d=new Date();return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`; }
    function dayDiff(a,b){ const da=new Date(a+'T00:00:00'); const db=new Date(b+'T00:00:00'); return Math.round((db - da)/86400000); }
    function save(k,v){ localStorage.setItem(k, JSON.stringify(v)); }
    function load(k,d){ const v=localStorage.getItem(k); return v?JSON.parse(v):d; }

    function applyTheme(c){
      document.documentElement.style.setProperty('--accent', c);
      const meta = document.querySelector('meta[name="theme-color"]');
      if (meta) meta.setAttribute('content', c);
      document.getElementById('theme').value = c;
      save(LS.theme, c);
    }

    function mkSliders(){
      const box = document.getElementById('sliders');
      box.innerHTML = '';
      STAGES.forEach((st,i)=>{
        const id = `s${i}`;
        const row = document.createElement('div');
        row.className = 'row';
        row.innerHTML = `
          <label for="${id}">${st.emoji} <strong>${st.name}</strong></label>
          <input id="${id}" type="range" min="0" max="100" value="50" step="1" />
        `;
        box.appendChild(row);
      });
    }

    function renderRadar(values){
      const N = values.length, size=420, cx=210, cy=210, R=160;
      const svg = document.getElementById('radar'); svg.innerHTML = '';
      // rings
      for (let r=1;r<=5;r++){
        const rr = R*(r/5);
        const c = document.createElementNS('http://www.w3.org/2000/svg','circle');
        c.setAttribute('cx',cx); c.setAttribute('cy',cy); c.setAttribute('r',rr);
        c.setAttribute('fill','none'); c.setAttribute('stroke','#2b1d4f'); c.setAttribute('stroke-width','1');
        svg.appendChild(c);
      }
      // axes + labels
      for (let i=0;i<N;i++){
        const ang = -Math.PI/2 + i*(2*Math.PI/N);
        const x = cx + Math.cos(ang)*R;
        const y = cy + Math.sin(ang)*R;
        const ln = document.createElementNS('http://www.w3.org/2000/svg','line');
        ln.setAttribute('x1',cx); ln.setAttribute('y1',cy); ln.setAttribute('x2',x); ln.setAttribute('y2',y);
        ln.setAttribute('stroke','#2b1d4f'); ln.setAttribute('stroke-width','1');
        svg.appendChild(ln);
        const lbx = cx + Math.cos(ang)*(R+18);
        const lby = cy + Math.sin(ang)*(R+18);
        const text = document.createElementNS('http://www.w3.org/2000/svg','text');
        text.setAttribute('x',lbx); text.setAttribute('y',lby); text.setAttribute('fill','var(--muted)'); text.setAttribute('font-size','12');
        text.setAttribute('text-anchor', Math.cos(ang)>0.2?'start':(Math.cos(ang)<-0.2?'end':'middle'));
        text.textContent = STAGES[i].emoji;
        svg.appendChild(text);
      }
      const pts = [];
      for (let i=0;i<N;i++){
        const ang = -Math.PI/2 + i*(2*Math.PI/N);
        const rr = (values[i]/100)*R;
        const x = cx + Math.cos(ang)*rr;
        const y = cy + Math.sin(ang)*rr;
        pts.push([x,y]);
      }
      const poly = document.createElementNS('http://www.w3.org/2000/svg','polygon');
      poly.setAttribute('points', pts.map(p=>p.join(',')).join(' '));
      poly.setAttribute('fill','var(--accent)'); poly.setAttribute('opacity','0.35');
      poly.setAttribute('stroke','var(--accent)'); poly.setAttribute('stroke-width','2');
      document.getElementById('radar').appendChild(poly);
    }

    function summarize(values){
      const pairs = values.map((v,i)=>({i,v})).sort((a,b)=>b.v-a.v);
      const top2 = pairs.slice(0,2).map(p=>STAGES[p.i].name).join('ï¼Œ');
      document.getElementById('summary').innerHTML = `
        <div>æœ€é«˜èƒ½é‡ï¼š<strong>${top2}</strong></div>
        <div class="muted">ï¼ˆæç¤ºï¼šä¿æŒé€£çºŒç·´ç¿’å¯ç²å¾—æ›´ç©©å®šçš„èƒ½é‡æ›²ç·šï¼‰</div>
      `;
      const kvs = document.getElementById('kvs'); kvs.innerHTML = '';
      STAGES.forEach((st,i)=>{
        const val = values[i];
        const status = val>=75? 'å¥½ç‹€æ…‹' : val>=40? 'ç©©å®šä¸­' : 'éœ€è¦è£œçµ¦';
        const color = val>=75? 'var(--good)': val>=40? 'var(--warn)':'var(--bad)';
        const det = document.createElement('details');
        det.innerHTML = `
          <summary>${st.emoji} <strong>${st.name}</strong> â€” <span style="color:${color}">${status}</span>ï¼ˆ${val}ï¼‰</summary>
          <div style="margin:8px 0 0 0">
            <div>é—œéµèªï¼š<em>${st.kv}</em></div>
            <div>è¡Œå‹•å»ºè­°ï¼š${st.action}</div>
            <div>ç²¾æ²¹å°æ‡‰ï¼š${st.oil}</div>
          </div>
        `;
        kvs.appendChild(det);
      });

      // è¡Œå‹•å‹•åŠ›å…«éµé…æ–¹ï¼ˆä¸ä½¿ç”¨ä¾†æºå­—çœ¼ï¼‰
      const map = {white:0, yellow:1, orange:2, violet:3, green:4, blue:7, indigo:6};
      const picks = [];
      STAGES.forEach((st,i)=>{
        const key = map[st.key];
        picks.push({name:E8[key].name, score:values[i]});
      });
      const best = {};
      picks.forEach(p=>{ if(!best[p.name] || best[p.name].score<p.score) best[p.name]=p; });
      const arr = Object.values(best).sort((a,b)=>b.score-a.score).slice(0,4);
      const box = document.getElementById('e8x'); box.innerHTML = '';
      arr.forEach(p=>{ const d=document.createElement('div'); d.className='chip'; d.textContent=p.name; box.appendChild(d); });
    }

    function updateCounters(){
      document.getElementById('tests').textContent = load('e7_tests', 0);
      document.getElementById('streak').textContent = load('e7_streak', 0) + ' å¤©';
      const badges = load('e7_badges', []);
      const box = document.getElementById('badges'); box.innerHTML='';
      if (badges.length===0){ const em=document.createElement('div'); em.className='chip'; em.textContent='ï¼ˆå°šæœªè§£é–ï¼‰'; box.appendChild(em); }
      else badges.forEach(b=>{ const d=document.createElement('div'); d.className='chip'; d.textContent=b; box.appendChild(d); });
    }

    function grantBadges(){
      const list = load('e7_badges', []);
      const add = (label)=>{ if(!list.includes(label)) list.push(label); };
      const tests = load('e7_tests', 0);
      const streak = load('e7_streak', 0);
      if (tests >= 1) add('ğŸ… è¦ºçŸ¥å•Ÿèˆªï¼ˆé¦–æ¬¡å®Œæˆï¼‰');
      if (streak >= 7) add('ğŸ… é€£çºŒä¹‹å…‰ï¼ˆé€£çºŒ 7 æ—¥ï¼‰');
      if (tests >= 10) add('ğŸ… èƒ½é‡æ¢éšªå®¶ï¼ˆç´¯ç© 10 æ¬¡ï¼‰');
      localStorage.setItem('e7_badges', JSON.stringify(list));
    }

    function tickCountersOnComplete(){
      let tests = load('e7_tests', 0) + 1;
      save('e7_tests', tests);
      const last = load('e7_last', null);
      const today = todayStr();
      if (!last){ save('e7_streak', 1); save('e7_last', today); }
      else {
        const diff = dayDiff(last, today);
        if (diff === 0){
          // same day
        } else if (diff === 1){
          save('e7_streak', load('e7_streak', 0)+1);
          save('e7_last', today);
        } else {
          save('e7_streak', 1);
          save('e7_last', today);
        }
      }
      grantBadges();
      updateCounters();
    }

    function downloadPNG(){
      const svg = document.getElementById('radar');
      const xml = new XMLSerializer().serializeToString(svg);
      const svg64 = btoa(unescape(encodeURIComponent(xml)));
      const img = new Image();
      img.onload = () => {
        const canvas = document.createElement('canvas');
        canvas.width = 1080; canvas.height = 1080;
        const ctx = canvas.getContext('2d');
        ctx.fillStyle = '#100b1f'; ctx.fillRect(0,0,1080,1080);
        ctx.fillStyle = '#ffffff'; ctx.font = 'bold 44px system-ui';
        ctx.fillText('Enervi7 Energy Radar', 40, 70);
        ctx.drawImage(img, 150, 140, 780, 780);
        ctx.fillStyle = '#cbb7ff'; ctx.font = '28px system-ui';
        ctx.fillText('è¡Œå‹•å‹•åŠ›å…«éµ â€” å¬å–š Ã— æˆå°± Ã— å‰µé€  Ã— é€£çºŒ', 40, 1030);
        const a = document.createElement('a'); a.href = canvas.toDataURL('image/png'); a.download='enervi7_radar.png'; a.click();
      };
      img.src = 'data:image/svg+xml;base64,' + svg64;
    }

    function init(){
      document.getElementById('summon').textContent = SUMMON_LINES[Math.floor(Math.random()*SUMMON_LINES.length)];
      const t = load('e7_theme', '#6a00ff'); applyTheme(t);
      document.getElementById('theme').addEventListener('input', e=>applyTheme(e.target.value));
      document.getElementById('resetTheme').addEventListener('click', ()=>applyTheme('#6a00ff'));
      mkSliders();
      const vals = Array(STAGES.length).fill(50);
      renderRadar(vals);
      summarize(vals);
      document.getElementById('gen').addEventListener('click', ()=>{
        const values = STAGES.map((_,i)=>Number(document.getElementById('s'+i).value));
        renderRadar(values); summarize(values); tickCountersOnComplete();
      });
      document.getElementById('download').addEventListener('click', downloadPNG);
      updateCounters();
      if ('serviceWorker' in navigator){ navigator.serviceWorker.register('./sw.js'); }
    }
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
